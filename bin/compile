#!/bin/bash

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3
VENDOR_DIR=$BUILD_DIR/vendor
PLUGINS_DIR=$BUILD_DIR/.docker/cli-plugins

echo
echo "-----> HOME        => $HOME"
echo "-----> BUILD_DIR   => $BUILD_DIR"
echo "-----> CACHE_DIR   => $CACHE_DIR"
echo "-----> VENDOR_DIR  => $VENDOR_DIR"
echo "-----> PLUGINS_DIR => $PLUGINS_DIR"

apt-get update
apt-get install -y --allow-downgrades --allow-remove-essential --allow-change-held-packages --force-yes apt-transport-https ca-certificates curl software-properties-common systemctl
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable"
apt-get update
apt-cache policy docker-ce

apt-get install -y --allow-downgrades --allow-remove-essential --allow-change-held-packages --force-yes docker-ce
systemctl status docker

cd "$BUILD_DIR"

echo "Running .heroku/run.sh" | sed 's/^/-----> /'

source .heroku/run.sh
